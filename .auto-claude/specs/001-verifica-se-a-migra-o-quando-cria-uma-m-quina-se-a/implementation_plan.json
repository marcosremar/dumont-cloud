{
  "feature": "Verificar e Corrigir Migra\u00e7\u00e3o GPU-para-CPU",
  "workflow_type": "investigation",
  "workflow_rationale": "Esta \u00e9 uma tarefa de verifica\u00e7\u00e3o de funcionalidade existente. O objetivo \u00e9 confirmar que a migra\u00e7\u00e3o GPU\u2192CPU funciona via testes Playwright, identificar problemas e corrigir se necess\u00e1rio. N\u00e3o \u00e9 desenvolvimento de nova feature.",
  "phases": [
    {
      "id": "phase-1-reproduce",
      "name": "Reproduzir Ambiente de Testes",
      "type": "setup",
      "description": "Configurar ambiente de testes e verificar que infraestrutura Playwright funciona",
      "depends_on": [],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Instalar depend\u00eancias Playwright no diret\u00f3rio tests/",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "tests/package.json"
          ],
          "verification": {
            "type": "command",
            "command": "cd tests && npm install && npx playwright --version",
            "expected": "Version output should show Playwright installed"
          },
          "status": "failed",
          "notes": "BLOCKER: Command 'npm' is not in the allowed commands for this project. Cannot run 'npm install' to install Playwright dependencies. User intervention required: either add 'npm' to allowed commands OR manually run 'cd tests && npm install && npx playwright install chromium' before resuming.",
          "updated_at": "2025-12-31T21:05:21.162631+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Verificar instala\u00e7\u00e3o de browsers Playwright",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "cd tests && npx playwright install chromium",
            "expected": "Chromium browser installed successfully"
          },
          "status": "failed",
          "notes": "BLOCKER: Command 'npx' is not in the allowed commands for this project. Cannot run 'npx playwright install chromium'. This subtask depends on subtask-1-1 (npm install) which also failed. User intervention required: manually run 'cd tests && npm install && npx playwright install chromium' before resuming.",
          "updated_at": "2025-12-31T21:06:33.433502+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Iniciar servi\u00e7o frontend web para testes",
          "service": "web",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "web/package.json"
          ],
          "verification": {
            "type": "command",
            "command": "cd web && npm install",
            "expected": "Dependencies installed successfully"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-2-investigate",
      "name": "Investigar Status dos Testes",
      "type": "investigation",
      "description": "Executar testes E2E existentes e analisar resultados para identificar problemas",
      "depends_on": [
        "phase-1-reproduce"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Executar teste de autentica\u00e7\u00e3o (auth.setup.js) para verificar login",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "tests/auth.setup.js"
          ],
          "expected_output": "Documento com: (1) Status do auth setup, (2) Erros encontrados se houver, (3) Configura\u00e7\u00f5es necess\u00e1rias",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test auth.setup.js --project=setup 2>&1 | head -50",
            "expected": "Auth test passes or clear error message"
          },
          "status": "pending"
        },
        {
          "id": "subtask-2-2",
          "description": "Executar testes cpu-standby-failover.spec.js e analisar resultados",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "tests/e2e-journeys/cpu-standby-failover.spec.js"
          ],
          "expected_output": "Relat\u00f3rio detalhado: (1) Quantos testes passaram/falharam, (2) Mensagens de erro, (3) Root cause de falhas",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/cpu-standby-failover.spec.js --reporter=line 2>&1 | tail -100",
            "expected": "Test results output"
          },
          "status": "pending"
        },
        {
          "id": "subtask-2-3",
          "description": "Executar testes failover-complete-journeys.spec.js e documentar status",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [
            "tests/e2e-journeys/failover-complete-journeys.spec.js"
          ],
          "expected_output": "Relat\u00f3rio: (1) Status de cada jornada de teste, (2) Erros espec\u00edficos, (3) Componentes UI problem\u00e1ticos",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/failover-complete-journeys.spec.js --reporter=line 2>&1 | tail -100",
            "expected": "Test results output"
          },
          "status": "pending"
        },
        {
          "id": "subtask-2-4",
          "description": "Gerar relat\u00f3rio HTML completo e documentar todos os problemas encontrados",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [
            "tests/INVESTIGATION_REPORT.md"
          ],
          "patterns_from": [],
          "expected_output": "Documento INVESTIGATION_REPORT.md com: (1) Resumo de todos os testes, (2) Root cause de cada falha, (3) Proposta de corre\u00e7\u00e3o",
          "verification": {
            "type": "manual",
            "instructions": "Verificar se INVESTIGATION_REPORT.md foi criado com an\u00e1lise completa dos problemas"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-3-fix",
      "name": "Corrigir Problemas Identificados",
      "type": "implementation",
      "description": "Implementar corre\u00e7\u00f5es para testes ou funcionalidade quebrada (BLOQUEADO at\u00e9 fase 2 completar)",
      "depends_on": [
        "phase-2-investigate"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Corrigir seletores Playwright quebrados em cpu-standby-failover.spec.js",
          "service": "tests",
          "files_to_modify": [
            "tests/e2e-journeys/cpu-standby-failover.spec.js"
          ],
          "files_to_create": [],
          "patterns_from": [
            "tests/e2e-journeys/machine-details-actions.spec.js"
          ],
          "notes": "Usar padr\u00f5es resilientes: .first(), .catch(() => false), timeout adequado",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/cpu-standby-failover.spec.js --reporter=line 2>&1 | grep -E '(passed|failed|\u2713|\u2717)'",
            "expected": "Tests pass or show clear progress"
          },
          "status": "pending"
        },
        {
          "id": "subtask-3-2",
          "description": "Corrigir seletores em failover-complete-journeys.spec.js se necess\u00e1rio",
          "service": "tests",
          "files_to_modify": [
            "tests/e2e-journeys/failover-complete-journeys.spec.js"
          ],
          "files_to_create": [],
          "patterns_from": [
            "tests/e2e-journeys/cpu-standby-failover.spec.js"
          ],
          "notes": "Seguir padr\u00f5es estabelecidos no subtask-3-1",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/failover-complete-journeys.spec.js --reporter=line 2>&1 | grep -E '(passed|failed|\u2713|\u2717)'",
            "expected": "Tests pass or show improvement"
          },
          "status": "pending"
        },
        {
          "id": "subtask-3-3",
          "description": "Atualizar auth.setup.js se necess\u00e1rio para melhor suporte a demo mode",
          "service": "tests",
          "files_to_modify": [
            "tests/auth.setup.js"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "notes": "Garantir que auth funciona tanto em modo real quanto demo",
          "verification": {
            "type": "command",
            "command": "cd tests && USE_DEMO_MODE=true npx playwright test auth.setup.js --project=setup 2>&1 | grep -E '(passed|failed|\u2713)'",
            "expected": "Auth setup passes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4-harden",
      "name": "Valida\u00e7\u00e3o Final e Documenta\u00e7\u00e3o",
      "type": "integration",
      "description": "Executar suite completa de testes de failover e documentar resultados finais",
      "depends_on": [
        "phase-3-fix"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Executar todos os testes de failover em sequ\u00eancia e gerar relat\u00f3rio",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Iniciar frontend em localhost:5173",
              "Executar npx playwright test e2e-journeys/*failover*.spec.js",
              "Verificar que todos os testes passam",
              "Gerar relat\u00f3rio HTML com npx playwright show-report"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-4-2",
          "description": "Documentar status final dos testes e corre\u00e7\u00f5es aplicadas",
          "service": "tests",
          "files_to_modify": [],
          "files_to_create": [
            "tests/FINAL_TEST_STATUS.md"
          ],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Verificar que FINAL_TEST_STATUS.md documenta: (1) Testes que passam, (2) Corre\u00e7\u00f5es aplicadas, (3) Pr\u00f3ximos passos"
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 4,
    "total_subtasks": 11,
    "services_involved": [
      "tests",
      "web"
    ],
    "parallelism": {
      "max_parallel_phases": 1,
      "parallel_groups": [],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential execution required - investigation workflow"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 001 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "during_implementation",
    "test_types_required": [
      "e2e"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "Playwright est\u00e1 instalado e funcional",
      "Testes de CPU Standby/Failover executam sem erros cr\u00edticos",
      "UI de migra\u00e7\u00e3o GPU\u2192CPU \u00e9 validada pelos testes",
      "Nenhum teste existente regrediu"
    ],
    "verification_steps": [
      {
        "name": "Playwright Installation Check",
        "command": "cd tests && npx playwright --version",
        "expected_outcome": "Version number displayed",
        "type": "setup",
        "required": true,
        "blocking": true
      },
      {
        "name": "E2E Failover Tests",
        "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/cpu-standby-failover.spec.js",
        "expected_outcome": "All tests pass or known issues documented",
        "type": "e2e",
        "required": true,
        "blocking": false
      },
      {
        "name": "E2E Complete Journeys",
        "command": "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/failover-complete-journeys.spec.js",
        "expected_outcome": "All tests pass or known issues documented",
        "type": "e2e",
        "required": true,
        "blocking": false
      }
    ],
    "reasoning": "Medium risk investigation task - focus is on E2E tests since that's the primary deliverable. Tests verify existing migration functionality."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": false,
      "commands": [],
      "services_to_test": []
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/cpu-standby-failover.spec.js",
        "cd tests && USE_DEMO_MODE=true npx playwright test e2e-journeys/failover-complete-journeys.spec.js"
      ],
      "flows": [
        "cpu-standby-verification",
        "failover-simulation",
        "settings-configuration",
        "failover-report-page"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:5173/app/machines",
          "checks": [
            "renders",
            "gpu-cards-visible",
            "backup-badges-visible"
          ]
        },
        {
          "url": "http://localhost:5173/app/settings",
          "checks": [
            "renders",
            "failover-tab-visible"
          ]
        },
        {
          "url": "http://localhost:5173/app/failover-report",
          "checks": [
            "renders",
            "content-loads"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": null,
  "last_updated": "2025-12-31T21:06:33.433511+00:00"
}