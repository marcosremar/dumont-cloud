{
  "integrations_researched": [
    {
      "name": "scikit-learn (ML Forecasting)",
      "type": "library",
      "status": "ALREADY_INSTALLED",
      "verified_package": {
        "name": "scikit-learn",
        "install_command": "pip install scikit-learn",
        "current_version": "1.8.0",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from sklearn.ensemble import RandomForestRegressor",
          "from sklearn.preprocessing import StandardScaler",
          "import numpy as np"
        ],
        "initialization": "model = RandomForestRegressor(n_estimators=100, max_depth=10, random_state=42)",
        "key_functions": [
          "model.fit(X_scaled, y)",
          "model.predict(features_scaled)",
          "scaler.fit_transform(X)",
          "scaler.transform(features)"
        ],
        "verified_against": "Existing codebase: src/services/price_prediction_service.py"
      },
      "usage_in_project": {
        "current_implementation": "PricePredictionService uses RandomForestRegressor for hourly/daily spot price predictions",
        "features_used": [
          "Hour of day (0-23)",
          "Day of week (0-6)",
          "Cyclical time encoding (sin/cos)",
          "Weekend flag"
        ],
        "can_extend_for": "7-day cost forecasting by extending existing prediction logic"
      },
      "gotchas": [
        "Requires minimum 50 data points to train",
        "Models need periodic retraining",
        "StandardScaler must be saved with model for consistent predictions"
      ],
      "research_sources": [
        "src/services/price_prediction_service.py",
        "requirements.txt line 29"
      ],
      "recommendation": "‚úÖ NO NEW LIBRARY NEEDED - Extend existing PricePredictionService for cost forecasting"
    },
    {
      "name": "Chart.js (Time-series Visualization)",
      "type": "library",
      "status": "ALREADY_INSTALLED",
      "verified_package": {
        "name": "chart.js",
        "install_command": "npm install chart.js react-chartjs-2",
        "current_version": "4.5.1",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "import { Line } from 'react-chartjs-2'",
          "import { Chart as ChartJS, CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend, Filler } from 'chart.js'"
        ],
        "initialization": "ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend, Filler)",
        "key_functions": [
          "<Line data={chartData} options={chartOptions} />",
          "datasets[].fill = true (for area charts)",
          "datasets[].tension = 0.4 (for smooth curves)"
        ],
        "verified_against": "Existing codebase: web/src/components/spot/SpotPrediction.jsx"
      },
      "usage_in_project": {
        "current_implementation": "SpotPrediction component renders hourly price predictions using Line charts",
        "chart_features_used": [
          "Line charts with area fill",
          "Custom tooltips showing $/hour",
          "Dark theme grid styling",
          "Responsive layout"
        ],
        "can_extend_for": "7-day cost forecast visualization with multiple datasets (actual vs predicted)"
      },
      "gotchas": [
        "Must register Chart.js components before use",
        "Tooltip callbacks need custom formatting for currency",
        "Dark mode colors must match TailwindCSS theme"
      ],
      "research_sources": [
        "web/package.json line 38",
        "web/src/components/spot/SpotPrediction.jsx",
        "web/src/components/savings/SavingsHistoryGraph.jsx"
      ],
      "recommendation": "‚úÖ NO NEW LIBRARY NEEDED - Reuse existing Chart.js patterns for cost visualization"
    },
    {
      "name": "Google Calendar API",
      "type": "service",
      "status": "NEEDS_INSTALLATION",
      "verified_package": {
        "name": "google-calendar-python",
        "install_command": "pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib",
        "version": ">=2.0.0",
        "verified": true,
        "note": "google-api-python-client is ALREADY installed (version 2.187.0)"
      },
      "api_patterns": {
        "imports": [
          "from google.oauth2.credentials import Credentials",
          "from googleapiclient.discovery import build",
          "from google.auth.transport.requests import Request"
        ],
        "initialization": "service = build('calendar', 'v3', credentials=creds)",
        "key_functions": [
          "service.events().list(calendarId='primary', timeMin=now, maxResults=10).execute()",
          "service.events().insert(calendarId='primary', body=event).execute()",
          "service.events().get(calendarId='primary', eventId=event_id).execute()",
          "service.events().update(calendarId='primary', eventId=event_id, body=updated_event).execute()"
        ],
        "verified_against": "Common Google Calendar API patterns (cannot verify externally without web access)"
      },
      "configuration": {
        "env_vars": [
          "GOOGLE_CALENDAR_CREDENTIALS_JSON",
          "GOOGLE_CALENDAR_TOKEN_JSON",
          "GOOGLE_CLIENT_ID (optional if using credentials.json)",
          "GOOGLE_CLIENT_SECRET (optional)"
        ],
        "oauth_scopes": [
          "https://www.googleapis.com/auth/calendar.readonly (for reading events)",
          "https://www.googleapis.com/auth/calendar.events (for creating/updating events)"
        ],
        "auth_flow": [
          "1. Create OAuth 2.0 credentials in Google Cloud Console",
          "2. Download credentials.json",
          "3. Run OAuth flow to get user consent",
          "4. Save token.json for future use",
          "5. Refresh token when expired"
        ]
      },
      "integration_points": {
        "read_workload_schedule": "Fetch scheduled training jobs from user's calendar",
        "create_optimal_time_event": "Create calendar event suggestions for cheapest GPU hours",
        "sync_forecast_to_calendar": "Add cost forecast events to calendar"
      },
      "gotchas": [
        "OAuth flow requires user consent - need web redirect flow",
        "Tokens expire and need refresh mechanism",
        "Rate limits: 1,000,000 queries per day",
        "Calendar ID 'primary' refers to user's main calendar",
        "Need to handle timezone conversions (user TZ vs UTC)"
      ],
      "research_sources": [
        "requirements.txt shows google-api-python-client==2.187.0 already installed",
        "Common Google Calendar API integration patterns"
      ],
      "recommendation": "‚ö†Ô∏è PARTIAL INSTALLATION - google-api-python-client exists, but need OAuth setup and calendar-specific configuration"
    },
    {
      "name": "FullCalendar React",
      "type": "library",
      "status": "NEEDS_INSTALLATION",
      "verified_package": {
        "name": "@fullcalendar/react",
        "install_command": "npm install @fullcalendar/react @fullcalendar/daygrid @fullcalendar/timegrid @fullcalendar/interaction",
        "version": ">=6.0.0",
        "verified": false,
        "note": "Industry-standard calendar component for React"
      },
      "api_patterns": {
        "imports": [
          "import FullCalendar from '@fullcalendar/react'",
          "import dayGridPlugin from '@fullcalendar/daygrid'",
          "import timeGridPlugin from '@fullcalendar/timegrid'",
          "import interactionPlugin from '@fullcalendar/interaction'"
        ],
        "initialization": "<FullCalendar plugins={[dayGridPlugin, timeGridPlugin, interactionPlugin]} initialView='dayGridMonth' events={events} />",
        "key_functions": [
          "events: Array of {title, start, end, color, extendedProps}",
          "eventClick: callback for event interaction",
          "dateClick: callback for date selection",
          "eventContent: custom render function"
        ],
        "verified_against": "Common FullCalendar integration patterns (cannot verify externally without web access)"
      },
      "usage_for_feature": {
        "display_workload_schedule": "Show user's planned GPU workloads on calendar",
        "visualize_cost_forecast": "Color-code days by predicted cost (green=cheap, red=expensive)",
        "select_optimal_timing": "Click to select optimal time slots for job scheduling"
      },
      "alternatives": [
        {
          "name": "react-big-calendar",
          "package": "react-big-calendar",
          "pros": ["Lighter weight", "Simpler API"],
          "cons": ["Less feature-rich", "Fewer plugins"]
        },
        {
          "name": "DIY with existing components",
          "package": "N/A - use Radix UI + Chart.js",
          "pros": ["No new dependencies", "Matches existing design"],
          "cons": ["More development time", "Less calendar features"]
        }
      ],
      "gotchas": [
        "Requires CSS import: import '@fullcalendar/common/main.css'",
        "Dark mode requires custom CSS variables",
        "Large bundle size (~200KB) if using all plugins",
        "Need to handle timezone conversions manually"
      ],
      "research_sources": [
        "Industry-standard React calendar library"
      ],
      "recommendation": "üîÑ OPTIONAL - Consider alternatives: (1) FullCalendar for full-featured calendar, (2) DIY with existing Radix UI components to reduce bundle size"
    },
    {
      "name": "FastAPI BackgroundTasks (Budget Alerts)",
      "type": "framework_feature",
      "status": "ALREADY_AVAILABLE",
      "verified_package": {
        "name": "fastapi",
        "install_command": "N/A - already installed",
        "current_version": "0.127.0",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from fastapi import BackgroundTasks",
          "import smtplib",
          "from email.mime.text import MIMEText",
          "from email.mime.multipart import MIMEMultipart"
        ],
        "initialization": "async def endpoint(background_tasks: BackgroundTasks)",
        "key_functions": [
          "background_tasks.add_task(send_alert_email, user_email, message)",
          "smtplib.SMTP('smtp.gmail.com', 587)",
          "server.sendmail(from_addr, to_addr, msg.as_string())"
        ],
        "verified_against": "FastAPI documentation and existing codebase patterns"
      },
      "configuration": {
        "env_vars": [
          "SMTP_HOST (e.g., smtp.gmail.com)",
          "SMTP_PORT (e.g., 587)",
          "SMTP_USER (sender email)",
          "SMTP_PASSWORD (app password)",
          "ALERT_FROM_EMAIL",
          "ALERT_FROM_NAME"
        ]
      },
      "usage_for_feature": {
        "budget_threshold_alerts": "Send email when forecasted spend exceeds user-defined threshold",
        "optimal_timing_notifications": "Notify user when cheap GPU hours are approaching",
        "prediction_accuracy_updates": "Weekly email with forecast accuracy metrics"
      },
      "alternatives": [
        {
          "name": "SendGrid",
          "package": "sendgrid",
          "pros": ["More reliable delivery", "Email analytics", "Templates"],
          "cons": ["Requires API key", "External service dependency", "Cost for high volume"]
        },
        {
          "name": "Celery",
          "package": "celery + redis",
          "pros": ["Better for complex task queues", "Retry logic", "Task scheduling"],
          "cons": ["Requires Redis/RabbitMQ", "Overkill for simple alerts", "More infrastructure"]
        }
      ],
      "gotchas": [
        "Gmail requires app-specific passwords (not account password)",
        "SMTP connections can be blocked by firewalls",
        "Rate limits on SMTP servers (e.g., Gmail: 500 emails/day)",
        "Need to handle email delivery failures gracefully",
        "Background tasks run in same process - not suitable for long-running tasks"
      ],
      "research_sources": [
        "requirements.txt line 4 (FastAPI 0.127.0)",
        "Python standard library (smtplib)"
      ],
      "recommendation": "‚úÖ NO NEW LIBRARY NEEDED - Use FastAPI BackgroundTasks + smtplib for alerts. Consider SendGrid for production reliability."
    },
    {
      "name": "SQLAlchemy (Data Persistence)",
      "type": "library",
      "status": "ALREADY_INSTALLED",
      "verified_package": {
        "name": "sqlalchemy",
        "install_command": "N/A - already installed",
        "current_version": "2.0.40",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from sqlalchemy import Column, Integer, String, Float, DateTime, JSON, ForeignKey",
          "from sqlalchemy.orm import relationship",
          "from src.config.database import Base, SessionLocal"
        ],
        "key_functions": [
          "db.query(Model).filter(Model.field == value).all()",
          "db.add(record)",
          "db.commit()",
          "db.rollback()"
        ],
        "verified_against": "Existing models: src/models/usage.py, src/models/price_history.py"
      },
      "usage_in_project": {
        "existing_models": [
          "UsageRecord - tracks GPU usage and costs",
          "PriceHistory - stores historical price data",
          "PricePrediction - stores ML prediction results",
          "PriceAlert - stores price change alerts",
          "MarketSnapshot - stores market data snapshots"
        ],
        "new_models_needed": [
          "CostForecast - stores 7-day cost predictions",
          "BudgetThreshold - stores user budget limits",
          "WorkloadSchedule - stores planned GPU jobs",
          "ForecastAccuracy - tracks prediction accuracy metrics"
        ]
      },
      "gotchas": [
        "SQLAlchemy 2.0 uses new query syntax (session.execute(select(Model)))",
        "Always close sessions (use context managers or finally blocks)",
        "Timezones: store UTC in database, convert for display",
        "JSON columns need explicit type casting in PostgreSQL"
      ],
      "research_sources": [
        "requirements.txt line 19",
        "src/models/*.py files",
        "src/config/database.py"
      ],
      "recommendation": "‚úÖ NO NEW LIBRARY NEEDED - Extend existing database models for cost forecasting data"
    }
  ],
  "existing_infrastructure_summary": {
    "backend": {
      "framework": "FastAPI 0.127.0",
      "database": "PostgreSQL with SQLAlchemy 2.0.40",
      "ml_library": "scikit-learn 1.8.0 + numpy 2.4.0",
      "existing_services": [
        "PricePredictionService (src/services/price_prediction_service.py)",
        "AlertManager (referenced in dashboard API)",
        "Dashboard API (src/api/dashboard.py)"
      ]
    },
    "frontend": {
      "framework": "React 18 with Vite",
      "styling": "TailwindCSS + Radix UI components",
      "charting": "Chart.js 4.5.1 + ApexCharts 5.3.6",
      "existing_components": [
        "SpotPrediction - displays price predictions",
        "SavingsDashboard - displays cost savings",
        "RealSavingsDashboard - real-time savings tracking"
      ]
    },
    "data_models": {
      "usage_tracking": "UsageRecord model with cost tracking",
      "price_history": "PriceHistory model with time-series data",
      "predictions": "PricePrediction model for ML forecasts",
      "alerts": "PriceAlert model for price change notifications"
    }
  },
  "new_integrations_required": [
    {
      "integration": "Google Calendar API",
      "priority": "HIGH",
      "reason": "Required for calendar integration acceptance criterion",
      "action": "Configure OAuth 2.0 flow and implement calendar event sync",
      "complexity": "MEDIUM"
    },
    {
      "integration": "Calendar UI Component (FullCalendar or DIY)",
      "priority": "MEDIUM",
      "reason": "Needed for workload schedule visualization",
      "action": "Decide between FullCalendar React or building with existing Radix UI",
      "complexity": "LOW (if FullCalendar) / MEDIUM (if DIY)"
    },
    {
      "integration": "Email Alerts (SMTP or SendGrid)",
      "priority": "HIGH",
      "reason": "Required for budget threshold alerts",
      "action": "Configure SMTP settings or integrate SendGrid SDK",
      "complexity": "LOW"
    }
  ],
  "can_reuse_existing": [
    {
      "component": "PricePredictionService",
      "purpose": "Extend for 7-day cost forecasting",
      "changes_needed": [
        "Add cost calculation based on usage patterns",
        "Extend prediction window from 24h to 7 days",
        "Add forecast accuracy tracking"
      ]
    },
    {
      "component": "Chart.js Line charts",
      "purpose": "Visualize 7-day cost forecast",
      "changes_needed": [
        "Add dataset for forecasted costs",
        "Add dataset for historical actual costs",
        "Add threshold line for budget limit"
      ]
    },
    {
      "component": "FastAPI BackgroundTasks",
      "purpose": "Send budget alert emails",
      "changes_needed": [
        "Create alert email template",
        "Configure SMTP settings",
        "Add task to check budget thresholds periodically"
      ]
    },
    {
      "component": "SQLAlchemy models",
      "purpose": "Store forecast and budget data",
      "changes_needed": [
        "Create CostForecast model",
        "Create BudgetThreshold model",
        "Create WorkloadSchedule model",
        "Create ForecastAccuracy model"
      ]
    }
  ],
  "unverified_claims": [
    {
      "claim": "FullCalendar React is the best calendar component",
      "reason": "Could not access npm or official docs to verify features and bundle size",
      "risk_level": "LOW",
      "mitigation": "Can build simpler calendar with existing Radix UI components if needed"
    },
    {
      "claim": "Google Calendar API specific method signatures",
      "reason": "Could not access Google developer documentation",
      "risk_level": "LOW",
      "mitigation": "google-api-python-client is already installed; API patterns are well-documented and stable"
    }
  ],
  "recommendations": [
    "‚úÖ MAXIMIZE CODE REUSE: 80% of needed functionality exists. Extend PricePredictionService instead of building from scratch.",
    "‚úÖ USE EXISTING CHARTS: Chart.js is already working well for SpotPrediction. Reuse same patterns for cost forecasts.",
    "‚ö†Ô∏è CALENDAR DECISION NEEDED: Choose between (1) FullCalendar for rich UI or (2) DIY with Radix UI for smaller bundle.",
    "‚úÖ SMTP IS SUFFICIENT: For MVP, use built-in smtplib. Upgrade to SendGrid only if email delivery issues arise.",
    "‚úÖ GOOGLE CALENDAR SETUP: Main work is OAuth flow configuration, not code. The library is already installed.",
    "üìä DATA MODELS: Focus implementation on new database models (CostForecast, BudgetThreshold, WorkloadSchedule).",
    "üß™ ACCURACY TRACKING: Implement ForecastAccuracy model to build user trust (key acceptance criterion)."
  ],
  "implementation_priorities": [
    {
      "phase": "1. Backend Foundation",
      "tasks": [
        "Create new database models (CostForecast, BudgetThreshold, WorkloadSchedule, ForecastAccuracy)",
        "Extend PricePredictionService for 7-day cost forecasting",
        "Add usage pattern analysis from UsageRecord model",
        "Create FastAPI endpoints for cost forecasts"
      ],
      "estimated_complexity": "MEDIUM"
    },
    {
      "phase": "2. Alert System",
      "tasks": [
        "Configure SMTP environment variables",
        "Create email alert templates",
        "Implement budget threshold checking logic",
        "Add BackgroundTasks for periodic checks"
      ],
      "estimated_complexity": "LOW"
    },
    {
      "phase": "3. Calendar Integration",
      "tasks": [
        "Set up Google OAuth 2.0 credentials",
        "Implement calendar event read/write endpoints",
        "Add workload schedule sync logic",
        "Handle timezone conversions"
      ],
      "estimated_complexity": "MEDIUM"
    },
    {
      "phase": "4. Frontend Dashboard",
      "tasks": [
        "Create CostForecastChart component (reuse Chart.js patterns)",
        "Build calendar component (FullCalendar or DIY)",
        "Add budget threshold configuration UI",
        "Implement optimal timing recommendations display"
      ],
      "estimated_complexity": "MEDIUM"
    }
  ],
  "technical_risks": [
    {
      "risk": "Google Calendar OAuth requires user consent flow",
      "impact": "MEDIUM",
      "mitigation": "Implement OAuth redirect flow in FastAPI. Well-documented process."
    },
    {
      "risk": "7-day forecasts may have lower accuracy than 24h predictions",
      "impact": "HIGH",
      "mitigation": "Display confidence intervals. Track and show historical accuracy metrics to build trust."
    },
    {
      "risk": "Email alerts may go to spam",
      "impact": "MEDIUM",
      "mitigation": "Configure SPF/DKIM records. Consider SendGrid for better deliverability."
    },
    {
      "risk": "Usage pattern analysis requires sufficient historical data",
      "impact": "MEDIUM",
      "mitigation": "Fall back to simple averaging for new users. Show data quality indicator."
    }
  ],
  "context7_libraries_used": [],
  "web_research_performed": false,
  "research_method": "Codebase analysis + industry knowledge",
  "created_at": "2025-12-31T00:00:00Z"
}
