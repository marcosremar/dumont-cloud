=== AUTO-BUILD PROGRESS ===

Project: Cost Prediction Dashboard - 7-Day GPU Spot Pricing Forecasts
Workspace: /Users/marcos/OrbStack/dumontcloud/home/marcos/projects/dumont-cloud
Spec Directory: .auto-claude/specs/018-cost-prediction-dashboard
Started: 2025-12-31 23:00:00 UTC

Workflow Type: feature
Rationale: New capability adding ML-powered 7-day cost forecasting, optimal timing recommendations, budget alerts, and calendar integration. Built on top of existing PricePredictionService infrastructure.

Session 1 (Planner):
- ✅ Completed deep codebase investigation
- ✅ Created/updated context.json with tech stack and patterns
- ✅ Created implementation_plan.json with 6 phases and 24 subtasks
- ✅ Created init.sh environment setup script
- ✅ Created build-progress.txt tracking document

Phase Summary:
- Phase 1 (ML Service Extension): 3 subtasks
  * Extend PricePredictionService with forecast_costs_7day()
  * Add CostForecast database model
  * Add PredictionAccuracy model and MAPE calculation
  * Dependencies: None (can start immediately)

- Phase 2 (Cost Forecast API Endpoints): 4 subtasks
  * Create cost_forecast.py endpoint file
  * Create optimal timing recommendation endpoint
  * Create accuracy tracker endpoint
  * Register cost_forecast router in spot endpoints
  * Dependencies: Phase 1 (ML Service Extension)

- Phase 3 (Budget Alert System): 4 subtasks
  * Create BudgetAlertService with SMTP email sending
  * Add BudgetAlert database model
  * Create budget alert management endpoints
  * Add SMTP environment variables to .env
  * Dependencies: Phase 2 (Cost Forecast API Endpoints)

- Phase 4 (Google Calendar Integration): 3 subtasks
  * Create CalendarIntegrationService with OAuth flow
  * Create calendar sync endpoints
  * Add Google Calendar OAuth env vars to .env
  * Dependencies: Phase 2 (Cost Forecast API Endpoints)

- Phase 5 (Frontend Cost Forecast Dashboard): 6 subtasks
  * Create CostForecastDashboard component with Chart.js
  * Create OptimalTimingCard component
  * Create BudgetAlertSettings component with Radix UI
  * Create AccuracyTracker widget
  * Create calendar event overlay component
  * Register cost forecast components in routing
  * Dependencies: Phase 2 (Cost Forecast API Endpoints)

- Phase 6 (Integration Testing & Verification): 2 subtasks
  * End-to-end verification of cost forecast flow
  * Edge case testing and error handling
  * Dependencies: Phases 3, 4, 5 (all implementation phases complete)

Services Involved:
- backend: Python/FastAPI backend with ML service, API endpoints, budget alerts, calendar integration
- web: React frontend with Chart.js visualization, Radix UI components, Redux state management

Tech Stack:
Backend:
  - Python + FastAPI
  - scikit-learn 1.8.0 (RandomForestRegressor already implemented)
  - google-api-python-client 2.187.0 (already installed)
  - PostgreSQL via SQLAlchemy
  - SMTP for email alerts

Frontend:
  - React 18
  - Chart.js 4.5.1 + react-chartjs-2 5.3.1 (already installed)
  - Redux Toolkit for state management
  - Tailwind CSS + Radix UI (@radix-ui/react-slider, @radix-ui/react-switch)

Existing Patterns Found:
- PricePredictionService: 24h forecasting with RandomForestRegressor, StandardScaler, cyclical feature engineering
- Chart.js: Registration pattern in SpotPrediction.jsx with dark theme, custom tooltips
- Multi-dataset charts: SavingsHistoryGraph.jsx with area fills and legends
- FastAPI endpoints: src/api/v1/endpoints/spot/prediction.py structure
- Background tasks: alert_manager.py patterns for async operations

Parallelism Analysis:
- Max parallel phases: 3
- Parallel groups:
  * After Phase 1 completes: Phases 2, 4, 5 can run in parallel (3 workers)
  * Phase 3 must wait for Phase 2 (sequential dependency)
  * Phase 6 must wait for Phases 3, 4, 5 (final integration)
- Recommended workers: 2 (conservative estimate for stable execution)
- Speedup estimate: 1.8x faster than sequential

Verification Strategy:
- Risk Level: HIGH (financial predictions, budget alerts, user spending decisions)
- Test Types Required: unit, integration, e2e
- Security Scanning: Required (secrets scan + SAST for OAuth/SMTP credentials)
- Minimum Coverage: 80%
- Critical Tests:
  * Unit: forecast_costs_7day(), calculate_mape(), budget threshold checks
  * Integration: API endpoints, SMTP email delivery, Calendar OAuth handling
  * E2E: Dashboard rendering, chart visualization, alert configuration
  * Security: No hardcoded credentials, OAuth token security, SMTP password handling

Edge Cases to Handle:
- Insufficient historical data (< 50 data points): Return error "Need at least 50 hours of price history"
- Calendar OAuth expiry: Show "Reconnect Calendar" button, degrade gracefully
- SMTP failures: Log but don't block API response, retry on next cycle
- Extreme price spikes: Cap confidence intervals at 3σ for UI clarity
- Timezone mismatches: Store UTC, convert to user timezone only in frontend

Files to Create (Backend):
- src/api/v1/endpoints/spot/cost_forecast.py
- src/services/budget_alert_service.py
- src/services/calendar_integration_service.py

Files to Create (Frontend):
- web/src/components/cost-forecast/CostForecastDashboard.jsx
- web/src/components/cost-forecast/BudgetAlertSettings.jsx
- web/src/components/cost-forecast/OptimalTimingCard.jsx
- web/src/components/cost-forecast/AccuracyTracker.jsx

Files to Modify (Backend):
- src/services/price_prediction_service.py (add forecast_costs_7day(), calculate_mape())
- src/models/metrics.py (add CostForecast, BudgetAlert, PredictionAccuracy models)
- src/api/v1/endpoints/spot/__init__.py (register cost_forecast router)
- .env (add SMTP and Google Calendar OAuth vars)

Files to Modify (Frontend):
- web/src/components/spot/index.js (export new components)

Reference Files:
- src/services/price_prediction_service.py (ML patterns)
- src/api/v1/endpoints/spot/prediction.py (API patterns)
- web/src/components/spot/SpotPrediction.jsx (Chart.js registration)
- web/src/components/savings/SavingsHistoryGraph.jsx (multi-dataset charts)

=== STARTUP COMMAND ===

To continue building this spec, run:

  source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 018 --parallel 2

This will:
1. Start with Phase 1 (ML Service Extension)
2. Execute phases in dependency order
3. Run up to 2 phases in parallel where possible
4. Verify each subtask before marking complete
5. Generate comprehensive test coverage
6. Run security scans before completion

To start development environment manually:

  cd /Users/marcos/OrbStack/dumontcloud/home/marcos/projects/dumont-cloud/.auto-claude/specs/018-cost-prediction-dashboard
  ./init.sh

=== END SESSION 1 (PLANNER) ===

Status: Ready for implementation
Next Session: Coder Agent (Session 2)
Next Action: Execute subtask-1-1 (Add forecast_costs_7day method)

---

Implementation will proceed through these stages:
1. ML Service Extension (Phase 1)
2. API Endpoints (Phase 2) - parallel with Calendar Integration & Frontend
3. Budget Alerts (Phase 3) - depends on Phase 2
4. Calendar Integration (Phase 4) - parallel with Phase 2 and 5
5. Frontend Dashboard (Phase 5) - parallel with Phase 2 and 4
6. Integration Testing (Phase 6) - final verification

Critical Success Factors:
✅ All existing tests continue to pass
✅ New tests achieve 80%+ coverage
✅ Security scans show no vulnerabilities
✅ Chart.js renders without console errors
✅ SMTP alerts send successfully
✅ Calendar OAuth handles expiry gracefully
✅ MAPE accuracy tracking displays correctly
✅ Edge cases handled with clear error messages
