{
  "integrations_researched": [
    {
      "name": "Exchange Rate API Service",
      "type": "service",
      "verified_package": {
        "name": "exchangerate-api.io or fixer.io",
        "install_command": "N/A - REST API service",
        "version": "N/A",
        "verified": false
      },
      "api_patterns": {
        "imports": ["import requests"],
        "initialization": "API_KEY required in environment variables",
        "key_functions": [
          "GET /latest?base=USD",
          "GET /convert?from=USD&to=EUR&amount=100"
        ],
        "verified_against": "NEEDS_VERIFICATION - Requires web search or documentation access"
      },
      "configuration": {
        "env_vars": [
          "EXCHANGE_RATE_API_KEY",
          "EXCHANGE_RATE_API_URL"
        ],
        "config_files": [],
        "dependencies": ["requests or httpx (already in project)"]
      },
      "infrastructure": {
        "requires_docker": false,
        "external_api": true,
        "rate_limits": "NEEDS_VERIFICATION - typically 1000-1500 requests/month on free tier"
      },
      "gotchas": [
        "NEEDS_VERIFICATION - Rate limits on free tiers",
        "NEEDS_VERIFICATION - Some APIs only update rates once per day",
        "Must handle API failures gracefully (use cached rates)",
        "BRL support varies by provider"
      ],
      "research_sources": [
        "NEEDS_VERIFICATION - Unable to access web search or documentation tools"
      ],
      "alternatives": [
        {
          "name": "exchangerate-api.io",
          "pros": "Free tier, supports BRL",
          "cons": "NEEDS_VERIFICATION",
          "verified": false
        },
        {
          "name": "fixer.io",
          "pros": "Reliable, used by many",
          "cons": "NEEDS_VERIFICATION - Free tier limitations",
          "verified": false
        },
        {
          "name": "openexchangerates.org",
          "pros": "Comprehensive",
          "cons": "NEEDS_VERIFICATION - Pricing",
          "verified": false
        },
        {
          "name": "European Central Bank API",
          "pros": "Free, official",
          "cons": "Limited currencies, EUR-centric",
          "verified": false
        }
      ]
    },
    {
      "name": "Babel (Python)",
      "type": "library",
      "verified_package": {
        "name": "babel",
        "install_command": "pip install babel",
        "version": ">=2.12.0",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from babel.numbers import format_currency",
          "from babel import Locale"
        ],
        "initialization": "locale = Locale.parse('en_US')",
        "key_functions": [
          "format_currency(amount, currency, locale='en_US')",
          "get_currency_name(currency, locale='en_US')",
          "get_currency_symbol(currency, locale='en_US')"
        ],
        "verified_against": "Standard library - widely used in FastAPI projects"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": ["pytz (usually bundled)"]
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Locale data must match currency (e.g., 'pt_BR' for BRL formatting)",
        "Does not handle exchange rates - only formatting",
        "Thread-safe for concurrent requests"
      ],
      "research_sources": [
        "https://babel.pocoo.org/en/latest/api/numbers.html",
        "Standard Python i18n library"
      ]
    },
    {
      "name": "Forex-Python",
      "type": "library",
      "verified_package": {
        "name": "forex-python",
        "install_command": "pip install forex-python",
        "version": ">=1.8",
        "verified": false
      },
      "api_patterns": {
        "imports": [
          "from forex_python.converter import CurrencyRates"
        ],
        "initialization": "c = CurrencyRates()",
        "key_functions": [
          "c.get_rate('USD', 'EUR')",
          "c.convert('USD', 'EUR', 100)"
        ],
        "verified_against": "NEEDS_VERIFICATION - Common in Python currency projects but may be outdated"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "NEEDS_VERIFICATION - May use deprecated data sources",
        "NEEDS_VERIFICATION - Real-time vs cached rates unclear",
        "Consider building custom integration with exchange rate API instead"
      ],
      "research_sources": [
        "NEEDS_VERIFICATION - PyPI page"
      ],
      "recommendation": "Consider using direct API integration instead of this library for better control"
    },
    {
      "name": "Dinero.js (JavaScript - Frontend)",
      "type": "library",
      "verified_package": {
        "name": "dinero.js",
        "install_command": "npm install dinero.js",
        "version": "^2.0.0",
        "verified": false
      },
      "api_patterns": {
        "imports": [
          "import { dinero, add, multiply } from 'dinero.js'",
          "import { USD, EUR, GBP, BRL } from '@dinero.js/currencies'"
        ],
        "initialization": "const price = dinero({ amount: 10000, currency: USD })",
        "key_functions": [
          "dinero({ amount, currency })",
          "toFormat(price, ({ amount, currency }) => `${currency.code} ${amount}`)",
          "add(price1, price2)",
          "multiply(price, factor)"
        ],
        "verified_against": "NEEDS_VERIFICATION - Popular library but needs confirmation on v2 API"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "NEEDS_VERIFICATION - v2 has breaking changes from v1",
        "Amounts stored as integers (e.g., $10.00 = 1000 cents)",
        "Immutable operations - returns new instances",
        "NEEDS_VERIFICATION - Bundle size impact"
      ],
      "research_sources": [
        "NEEDS_VERIFICATION - npm and documentation"
      ],
      "alternatives": [
        {
          "name": "currency.js",
          "pros": "Lighter weight, simpler API",
          "cons": "Less features than Dinero.js",
          "verified": false
        }
      ]
    },
    {
      "name": "React-Intl / FormatJS",
      "type": "library",
      "verified_package": {
        "name": "react-intl",
        "install_command": "npm install react-intl",
        "version": "^6.0.0",
        "verified": false
      },
      "api_patterns": {
        "imports": [
          "import { IntlProvider, FormattedNumber } from 'react-intl'"
        ],
        "initialization": "<IntlProvider locale=\"en\" messages={messages}>",
        "key_functions": [
          "<FormattedNumber value={price} style=\"currency\" currency=\"USD\" />",
          "intl.formatNumber(price, { style: 'currency', currency: 'EUR' })"
        ],
        "verified_against": "NEEDS_VERIFICATION - FormatJS documentation"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["locale data files"],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false
      },
      "gotchas": [
        "Requires IntlProvider wrapper at app root",
        "Locale data can increase bundle size",
        "NEEDS_VERIFICATION - Compatibility with existing i18n setup"
      ],
      "research_sources": [
        "NEEDS_VERIFICATION - formatjs.io documentation"
      ],
      "recommendation": "Good if project already has internationalization; otherwise Dinero.js may be simpler"
    },
    {
      "name": "APScheduler (Python)",
      "type": "library",
      "verified_package": {
        "name": "apscheduler",
        "install_command": "pip install apscheduler",
        "version": ">=3.10.0",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from apscheduler.schedulers.asyncio import AsyncIOScheduler",
          "from apscheduler.triggers.cron import CronTrigger"
        ],
        "initialization": "scheduler = AsyncIOScheduler()",
        "key_functions": [
          "scheduler.add_job(update_exchange_rates, CronTrigger(hour=0))",
          "scheduler.start()"
        ],
        "verified_against": "Widely used in FastAPI applications"
      },
      "configuration": {
        "env_vars": [],
        "config_files": [],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false,
        "notes": "Runs in-process with FastAPI application"
      },
      "gotchas": [
        "Must be initialized in FastAPI startup event",
        "Jobs run in same process - use async functions",
        "Timezone awareness required for daily updates",
        "Does not persist across restarts - consider external cron if that's needed"
      ],
      "research_sources": [
        "https://apscheduler.readthedocs.io/",
        "Standard scheduling library for Python"
      ]
    },
    {
      "name": "Stripe Payment Processing",
      "type": "service",
      "verified_package": {
        "name": "stripe",
        "install_command": "pip install stripe",
        "version": ">=5.0.0",
        "verified": false
      },
      "api_patterns": {
        "imports": [
          "import stripe"
        ],
        "initialization": "stripe.api_key = os.getenv('STRIPE_SECRET_KEY')",
        "key_functions": [
          "stripe.Price.create(currency='usd', unit_amount=1000)",
          "stripe.checkout.Session.create(currency='eur')"
        ],
        "verified_against": "NEEDS_VERIFICATION - Stripe documentation for multi-currency"
      },
      "configuration": {
        "env_vars": [
          "STRIPE_SECRET_KEY",
          "STRIPE_PUBLISHABLE_KEY"
        ],
        "config_files": [],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false,
        "external_api": true
      },
      "gotchas": [
        "NEEDS_VERIFICATION - Multi-currency requires Stripe account setup",
        "NEEDS_VERIFICATION - BRL support and local payment methods",
        "Each price object is tied to a specific currency",
        "NEEDS_VERIFICATION - Conversion fees and settlement currency",
        "NEEDS_VERIFICATION - Payout support for non-USD currencies"
      ],
      "research_sources": [
        "NEEDS_VERIFICATION - https://stripe.com/docs/currencies"
      ],
      "recommendation": "CRITICAL: Must verify if Stripe is already integrated in project and what multi-currency features are available"
    },
    {
      "name": "Database Schema Changes",
      "type": "infrastructure",
      "verified_package": {
        "name": "alembic",
        "install_command": "pip install alembic",
        "version": "Already in project (SQLAlchemy dependency)",
        "verified": true
      },
      "api_patterns": {
        "imports": [
          "from sqlalchemy import Column, String, Float, DateTime, ForeignKey"
        ],
        "initialization": "N/A",
        "key_functions": [
          "alembic revision --autogenerate -m 'Add currency tables'",
          "alembic upgrade head"
        ],
        "verified_against": "SQLAlchemy already in requirements.txt"
      },
      "configuration": {
        "env_vars": [],
        "config_files": ["alembic.ini", "migration files"],
        "dependencies": []
      },
      "infrastructure": {
        "requires_docker": false,
        "database_tables_needed": [
          "exchange_rates (currency_from, currency_to, rate, updated_at)",
          "user_currency_preferences (user_id, preferred_currency)",
          "price_in_currency (product_id, currency, amount)"
        ]
      },
      "gotchas": [
        "Must create migration scripts for new tables",
        "Consider indexing on currency columns for performance",
        "Timestamp columns for rate staleness detection"
      ],
      "research_sources": [
        "SQLAlchemy documentation",
        "Alembic migration documentation"
      ]
    }
  ],
  "unverified_claims": [
    {
      "claim": "Exchange rate API service availability and pricing",
      "reason": "Unable to access web search to verify current API providers, rate limits, and BRL support",
      "risk_level": "high",
      "recommendation": "MUST verify before implementation: Check exchangerate-api.io, fixer.io, openexchangerates.org for free tier limits and BRL support"
    },
    {
      "claim": "Dinero.js v2 API patterns",
      "reason": "Unable to verify current npm package and API documentation",
      "risk_level": "medium",
      "recommendation": "Check npm package and documentation for v2 API changes and bundle size impact"
    },
    {
      "claim": "Stripe multi-currency support for USD, EUR, GBP, BRL",
      "reason": "Unable to verify Stripe's current multi-currency capabilities and BRL support",
      "risk_level": "high",
      "recommendation": "CRITICAL: Verify Stripe supports all required currencies and local payment methods for Brazil"
    },
    {
      "claim": "Forex-Python library currency data source",
      "reason": "Unable to verify if this library is maintained and uses reliable data sources",
      "risk_level": "medium",
      "recommendation": "Consider building direct API integration instead of using this library for better control"
    },
    {
      "claim": "React-Intl compatibility with existing project setup",
      "reason": "Unknown if project already has i18n infrastructure that could conflict",
      "risk_level": "low",
      "recommendation": "Check existing codebase for i18n patterns before adding React-Intl"
    }
  ],
  "recommendations": [
    "CRITICAL: Verify existing payment processor integration before proceeding - check if Stripe, PayPal, or another processor is already integrated",
    "CRITICAL: Research and select exchange rate API provider that supports all required currencies (USD, EUR, GBP, BRL) with adequate free tier or acceptable pricing",
    "Recommended architecture: Backend stores and updates exchange rates daily; Frontend fetches current rates from backend API (not directly from external API)",
    "Use Babel for backend currency formatting (already a standard Python library)",
    "Evaluate Dinero.js vs currency.js vs React-Intl for frontend based on bundle size and existing i18n infrastructure",
    "Create database migrations for: exchange_rates table, user_currency_preferences, and any product price tables that need currency support",
    "Implement fallback mechanism for when exchange rate API is unavailable (use last known rates)",
    "Add monitoring/alerting for exchange rate update failures",
    "Consider caching strategy for exchange rates (Redis or in-memory cache)",
    "Document exchange rate update schedule and data source in user-facing checkout UI"
  ],
  "critical_missing_information": [
    {
      "question": "What payment processor is currently integrated?",
      "impact": "Determines multi-currency billing implementation strategy",
      "action_required": "Search codebase for Stripe, PayPal, or other payment integrations"
    },
    {
      "question": "Does existing i18n infrastructure exist?",
      "impact": "Affects choice of frontend currency formatting library",
      "action_required": "Check for react-intl, i18next, or other i18n libraries in web/package.json and source code"
    },
    {
      "question": "What is the product pricing model?",
      "impact": "Determines how prices are stored and converted",
      "action_required": "Review database schema for existing price/product tables"
    },
    {
      "question": "Are there existing scheduled jobs or cron tasks?",
      "impact": "Determines how to integrate daily exchange rate updates",
      "action_required": "Search for APScheduler, celery, or cron job configurations"
    }
  ],
  "stack_confirmed": {
    "backend": "FastAPI (Python 3.x)",
    "frontend": "React 18 + Vite",
    "database": "PostgreSQL (via SQLAlchemy)",
    "existing_libraries": {
      "http_clients": ["requests", "httpx", "aiohttp"],
      "database": ["sqlalchemy", "psycopg2-binary"],
      "utilities": ["python-dateutil", "python-dotenv"],
      "frontend_ui": ["@radix-ui/*", "tailwindcss"],
      "state_management": ["@reduxjs/toolkit", "react-redux"]
    }
  },
  "research_limitations": {
    "tools_unavailable": [
      "WebSearch - requires permissions",
      "Context7 MCP - not configured in project"
    ],
    "impact": "Unable to verify current API documentation, npm package versions, and service availability",
    "mitigation": "Provided research based on standard, well-known libraries with verification flags"
  },
  "created_at": "2025-12-31T22:20:00Z"
}
