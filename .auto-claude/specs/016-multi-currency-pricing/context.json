{
  "task_description": "Implement multi-currency pricing system supporting USD, EUR, GBP, BRL with daily exchange rate updates, user currency preferences, and transparent conversion rates at checkout",
  "scoped_services": [
    "cli (backend)",
    "web (frontend)",
    "database (PostgreSQL)"
  ],
  "files_to_modify": {
    "backend": [
      "src/main.py",
      ".env"
    ]
  },
  "files_to_create": {
    "backend": [
      "src/models/currency.py",
      "src/api/v1/endpoints/currency.py",
      "src/api/v1/schemas/currency.py",
      "src/services/exchange_rate.py",
      "src/core/scheduler.py"
    ],
    "frontend": [
      "web/src/store/slices/currencySlice.js",
      "web/src/components/CurrencySelector.jsx",
      "web/src/utils/formatCurrency.js"
    ]
  },
  "files_to_reference": [
    "src/api/v1/endpoints/auth.py",
    "src/models/machine_history.py",
    "src/models/price_history.py",
    "web/src/store/slices/authSlice.js",
    "src/config/database.py"
  ],
  "patterns": {
    "backend_api_pattern": "FastAPI with APIRouter, prefix and tags, Depends for dependency injection, HTTPException for errors, Pydantic response models",
    "backend_model_pattern": "SQLAlchemy models inherit from src.config.database.Base, use Column types (Integer, String, Float, DateTime, Numeric), include __table_args__ for indexes, implement to_dict() method",
    "backend_database": "PostgreSQL via SQLAlchemy ORM, SessionLocal from src.config.database, models in src/models/",
    "frontend_redux_pattern": "Redux Toolkit with createSlice and createAsyncThunk, localStorage.setItem/getItem for persistence, fetch API with VITE_API_URL",
    "frontend_component_pattern": "React functional components with hooks, Radix UI for dropdowns/selects, Tailwind CSS for styling",
    "decimal_precision": "Use Numeric(18,6) for exchange rates, Float for prices in existing models"
  },
  "existing_implementations": {
    "price_storage": "src/models/price_history.py - PriceHistory model with Float columns for min/max/avg prices",
    "api_structure": "src/api/v1/endpoints/ - router pattern with prefix, tags, dependencies",
    "redux_store": "web/src/store/slices/ - authSlice.js, instancesSlice.js, uiSlice.js, userSlice.js patterns",
    "database_config": "src/config/database.py - SessionLocal, Base, get_db()",
    "scheduler": "NONE - No existing APScheduler, Celery, or cron jobs found. Will create new scheduler in src/core/scheduler.py"
  },
  "technical_decisions": {
    "base_currency": "USD - all prices stored in USD, converted on-demand to other currencies",
    "exchange_rate_api": "exchangerate-api.io (free tier ~1500 req/month)",
    "scheduler": "APScheduler with AsyncIOScheduler (in-process with FastAPI)",
    "caching": "Redis for exchange rates (REDIS_URL already configured)",
    "formatting_backend": "Babel for currency formatting",
    "formatting_frontend": "Dinero.js v2 for money calculations",
    "supported_currencies": ["USD", "EUR", "GBP", "BRL"]
  },
  "environment_vars_required": {
    "EXCHANGE_RATE_API_KEY": "API key for exchange rate service",
    "EXCHANGE_RATE_API_URL": "Base URL for exchange rate API"
  },
  "dependencies_to_add": {
    "backend": [
      "babel>=2.12.0",
      "apscheduler>=3.10.0",
      "httpx>=0.24.0"
    ],
    "frontend": [
      "dinero.js@^2.0.0",
      "@dinero.js/currencies@^2.0.0"
    ]
  },
  "created_at": "2025-12-31T22:30:00.000000"
}
