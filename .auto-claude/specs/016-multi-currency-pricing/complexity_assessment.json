{
  "complexity": "complex",
  "workflow_type": "feature",
  "confidence": 0.85,
  "reasoning": "Multi-currency pricing involves external API integration (exchange rates), database schema changes for financial data, and cross-cutting changes across pricing, checkout, and billing systems. Requires research for exchange rate APIs and payment processor capabilities, plus careful handling of financial accuracy.",

  "analysis": {
    "scope": {
      "estimated_files": 15,
      "estimated_services": 2,
      "is_cross_cutting": true,
      "notes": "Affects pricing display, checkout flow, billing system, user preferences, and database models. Requires scheduled jobs for daily rate updates."
    },
    "integrations": {
      "external_services": ["Exchange Rate API (e.g., exchangerate-api, fixer.io)", "Payment Processor (multi-currency support)"],
      "new_dependencies": ["exchange-rate API client", "currency formatting library"],
      "research_needed": true,
      "notes": "Need to research and select appropriate exchange rate API. Must understand payment processor's multi-currency capabilities and limitations."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": true,
      "config_changes": true,
      "notes": "Database schema changes for currency rates table, user currency preferences, and multi-currency price storage. New environment variables for exchange rate API keys and cron schedule configuration."
    },
    "knowledge": {
      "patterns_exist": false,
      "research_required": true,
      "unfamiliar_tech": ["Exchange rate APIs", "Payment processor multi-currency features", "Currency conversion patterns"],
      "notes": "Multi-currency support likely new to codebase. Requires understanding of exchange rate API options, payment processor limitations, and best practices for handling currency conversions in financial systems."
    },
    "risk": {
      "level": "high",
      "concerns": [
        "Exchange rate API reliability and fallback strategies",
        "Payment processor multi-currency limitations",
        "Currency conversion accuracy for billing",
        "Rate changes during checkout (consistency)",
        "Existing subscription migration to multi-currency",
        "Financial data integrity",
        "API key security for exchange rate service"
      ],
      "notes": "Financial accuracy is critical. Must handle edge cases like API failures, rate staleness, and ensure billing amounts are correct. High user impact if currency conversions are wrong."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "self_critique",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": true,
    "needs_infrastructure_setup": false
  },

  "validation_recommendations": {
    "risk_level": "high",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scan_required": true,
    "staging_deployment_required": false,
    "reasoning": "Financial system changes require comprehensive testing including E2E for checkout flows with different currencies. Security scan needed for API key management and financial data handling. No staging deployment required as this doesn't involve infrastructure changes, but thorough testing is critical."
  },

  "created_at": "2025-12-31T00:00:00Z"
}
