# Build Progress: Add ARIA Labels and Keyboard Navigation to MachineCard

## Status: Planning Complete

## Summary
This task adds proper accessibility attributes (aria-label, aria-expanded, aria-haspopup) to all interactive elements in MachineCard component, plus keyboard navigation support for dropdown menus.

## Key Files
- `web/src/components/machines/MachineCard.jsx` - Main component with 15+ interactive elements
- `web/src/components/tailadmin-ui/index.jsx` - DropdownMenu component to enhance

## Interactive Elements Identified
1. **Failover Strategy Dropdown** (custom) - Lines 450-526
   - Trigger button lacks aria-expanded, aria-haspopup, aria-label
   - Options need role="menuitem"
   - Close button needs aria-label

2. **Backup Info Popup** (custom) - Lines 530-618
   - Badge needs role="button", aria-expanded
   - Close button needs aria-label

3. **Main Options Menu** (DropdownMenu) - Lines 621-665
   - Trigger needs aria-label

4. **Copy Buttons** - Lines 671-723
   - IP copy button needs aria-label
   - SSH copy button needs aria-label

5. **IDE Buttons** - Lines 774-793
   - VS Code dropdown needs aria-haspopup
   - Cursor/Windsurf buttons need aria-labels

6. **Action Buttons** - Lines 796-930
   - Failover, Testar, CPU, Pause, Start buttons need aria-labels

## Implementation Plan
7 phases with 16 subtasks total:
- Phase 1: Add ARIA labels to action buttons (3 subtasks)
- Phase 2: Add ARIA attributes to failover dropdown (3 subtasks)
- Phase 3: Add ARIA attributes to backup popup (3 subtasks)
- Phase 4: Add ARIA to copy buttons (2 subtasks)
- Phase 5: Enhance DropdownMenu component (2 subtasks)
- Phase 6: Add accessible status indicators (2 subtasks)
- Phase 7: Testing and validation (1 subtask)

## Progress Log
- [2026-01-01] Created implementation plan with 7 phases and 16 subtasks
- [2026-01-01] Recorded codebase discoveries for accessibility patterns
- [2026-01-01] Completed 5.2: Added full keyboard navigation to DropdownMenu component
  - Escape key closes dropdown and returns focus to trigger
  - Arrow Up/Down navigates between menu items (with wrap-around)
  - Enter/Space activates focused menu item
  - Home/End keys go to first/last item
  - Tab closes dropdown and lets focus move naturally
  - Focus ring styles for keyboard visibility
  - Focus management with proper ref tracking
- [2026-01-01] Completed 7.1: Created comprehensive accessibility tests
  - Created tests/e2e-journeys/accessibility-machinecard.spec.js with 12 test suites
  - Tests cover ARIA labels on action buttons, IDE buttons, main menu
  - Tests verify failover dropdown ARIA (aria-expanded, aria-haspopup, role="menu")
  - Tests verify backup badge ARIA (role="button", aria-expanded)
  - Tests verify copy buttons have aria-labels and aria-live announcements
  - Keyboard navigation tests for failover dropdown (Escape, Arrow, Enter, Tab, Home/End)
  - Keyboard navigation tests for backup popup (Escape, Enter/Space)
  - Keyboard navigation tests for main options menu
  - Status badge ARIA tests (aria-label, aria-busy)
  - Failover progress ARIA live region tests
  - Focus visibility tests
- [2026-01-01] Completed 7.2: Manual Screen Reader Testing Documentation

---

## Screen Reader Testing Guide

This section documents the manual screen reader testing checklist for the MachineCard component accessibility implementation.

### Recommended Screen Readers
- **macOS**: VoiceOver (built-in, activate with Cmd+F5)
- **Windows**: NVDA (free), JAWS (commercial)
- **Linux**: Orca (GNOME)

### Testing Checklist

#### 1. Action Buttons Announcements
Test that action buttons announce their purpose correctly:

| Element | Expected Announcement (Portuguese) |
|---------|-----------------------------------|
| Start button | "Iniciar máquina {GPU name}" |
| Pause button | "Pausar máquina {GPU name}" |
| CPU migration button | "Migrar para CPU" |
| GPU migration button | "Migrar para GPU" |
| Failover button | "Configurar failover" |
| Testar button | "Simular failover" |

#### 2. IDE Buttons Announcements
| Element | Expected Announcement |
|---------|----------------------|
| VS Code button | "Abrir VS Code, menu popup" |
| Cursor button | "Abrir Cursor IDE" |
| Windsurf button | "Abrir Windsurf IDE" |

#### 3. Main Options Menu
| Element | Expected Announcement |
|---------|----------------------|
| Menu trigger (MoreVertical) | "Menu de opções da máquina, menu popup" |
| Menu items | Each announces with role "menuitem" |

#### 4. Failover Strategy Dropdown
| Element | Expected Behavior |
|---------|------------------|
| Trigger badge | "Estratégia de failover: {current strategy}, menu popup, collapsed/expanded" |
| Dropdown opens | Announces "Opções de estratégia de failover, menu" |
| Strategy options | Each announces as "menuitem" with label |
| Close button | "Fechar menu de failover" |
| Keyboard navigation | Arrow keys navigate, Enter/Space selects, Escape closes |

#### 5. Backup Info Popup
| Element | Expected Behavior |
|---------|------------------|
| Backup badge | "Informações de backup: Backup ativo/Sem backup, button, collapsed/expanded" |
| Popup opens | Focus moves to popup content |
| Close button | "Fechar informações de backup" |
| Escape key | Closes popup, focus returns to badge |

#### 6. Copy Buttons
| Element | Expected Behavior |
|---------|------------------|
| IP copy button | "Copiar endereço IP" |
| SSH copy button | "Copiar comando SSH" |
| SSH Config menu item | "Copiar configuração SSH para o arquivo de config" |
| After copy | Screen reader announces "Endereço IP copiado!" / "Comando SSH copiado!" / "Configuração SSH copiada!" |

#### 7. Status Indicators
| Element | Expected Announcement |
|---------|----------------------|
| Status badge | "Status da máquina: {status}" (e.g., Online, Pausada, etc.) |
| Loading states | aria-busy="true" indicates loading |
| Loading panel | "Máquina {status}" with busy state |

#### 8. Failover Progress Panel
| Element | Expected Behavior |
|---------|------------------|
| Progress panel | role="region" with aria-label="Progresso do failover" |
| Live updates | Announces phase changes: "Failover iniciado", "Buscando nova GPU", "Failover concluído" |
| Completion | Announces total time if available |

#### 9. Navigation Order
Verify that Tab order follows a logical sequence:
1. GPU name and status area
2. Failover strategy dropdown
3. Backup info badge
4. Main options menu (MoreVertical)
5. IP/SSH copy buttons
6. Metrics area (if running)
7. IDE buttons (VS Code, Cursor, Windsurf)
8. Action buttons (Failover, Testar, CPU, Pause/Start)

#### 10. Focus Visibility
- All focusable elements show visible focus ring (focus:ring-2 focus:ring-brand-500)
- Focus is trapped within modals/dropdowns when open
- Focus returns to trigger when closing dropdowns/popups

### Testing Procedure

1. **Navigate to MachineCard**
   - Use Tab key to reach the first interactive element
   - Verify focus ring is visible

2. **Test each dropdown/popup**
   - Focus on trigger
   - Press Enter/Space to open
   - Verify screen reader announces expanded state
   - Use Arrow keys to navigate options
   - Press Escape to close
   - Verify focus returns to trigger

3. **Test copy functionality**
   - Focus on copy button
   - Press Enter/Space
   - Verify screen reader announces copy confirmation

4. **Test action buttons**
   - Tab through each button
   - Verify purpose is announced

5. **Test failover progress (if applicable)**
   - Simulate failover
   - Verify phase changes are announced

### Known Limitations
- Some tooltips may not be accessible to screen readers (title attributes)
- Sparkline charts are decorative and not announced
- Loading spinner animations are decorative (aria-hidden)

### Accessibility Standards
This implementation follows:
- WCAG 2.1 Level AA guidelines
- WAI-ARIA 1.2 best practices for menus and popups
- Focus management patterns for modal dialogs
