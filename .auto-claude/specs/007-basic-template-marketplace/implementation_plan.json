{
  "feature": "Basic Template Marketplace",
  "workflow_type": "feature",
  "workflow_rationale": "Building net-new marketplace functionality with pre-configured ML workload templates. Extends existing instance provisioning with template abstraction layer. Feature workflow follows service dependency order: backend models \u2192 backend API \u2192 frontend state \u2192 frontend UI.",
  "phases": [
    {
      "id": "phase-1-backend-models",
      "name": "Backend Models & Data",
      "type": "implementation",
      "description": "Create template dataclass models and seed data for 4 official templates (JupyterLab, Stable Diffusion, ComfyUI, vLLM)",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create marketplace module structure",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "src/modules/marketplace/__init__.py"
          ],
          "patterns_from": [
            "src/modules/machines/__init__.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"import src.modules.marketplace; print('OK')\"",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created src/modules/marketplace/__init__.py with module docstring and placeholder exports. Follows existing module patterns. Verification passed: module is importable.",
          "updated_at": "2025-12-31T21:40:19.661409+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Create Template dataclass model with GPU requirements",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "src/modules/marketplace/models.py"
          ],
          "patterns_from": [
            "src/modules/machines/models.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.modules.marketplace.models import Template; t = Template(id=1, name='Test', slug='test', docker_image='test:latest', gpu_min_vram=4, gpu_recommended_vram=8, ports=[8888], volumes=[], launch_command='test', cuda_version='11.8'); print('OK')\"",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Template dataclass model with GPU requirements, TemplateGPURequirements helper class, and TemplateCategory enum. Verification passed. Commit: 2a4a858",
          "updated_at": "2025-12-31T21:43:31.492479+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Create templates seed data JSON file with 4 official templates",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "src/modules/marketplace/templates_seed.json"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "python -c \"import json; data = json.load(open('src/modules/marketplace/templates_seed.json')); assert len(data) == 4; print('OK')\"",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created templates_seed.json with 4 official templates: JupyterLab, Stable Diffusion WebUI, ComfyUI, and vLLM. Each template includes Docker image, ports, volumes, launch command, environment variables, and GPU requirements as specified. Verification passed. Commit: dc1da92",
          "updated_at": "2025-12-31T21:46:36.337189+00:00"
        }
      ]
    },
    {
      "id": "phase-2-backend-service",
      "name": "Backend Service Layer",
      "type": "implementation",
      "description": "Create TemplateService for business logic (CRUD, template loading, deployment preparation)",
      "depends_on": [
        "phase-1-backend-models"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create TemplateService class with CRUD operations",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "services/template_service.py"
          ],
          "patterns_from": [
            "services/vast_service.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from services.template_service import TemplateService; ts = TemplateService(); templates = ts.get_all_templates(); assert len(templates) == 4; print('OK')\"",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created TemplateService class with CRUD operations: get_all_templates, get_template_by_slug, get_template_by_id, filter_by_vram, filter_by_category, get_verified_templates. Loads 4 templates from seed JSON file. Updated services/__init__.py to export TemplateService. Verification passed. Commit: 7827531",
          "updated_at": "2025-12-31T21:49:55.512161+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Extend VastService with template-aware instance creation",
          "service": "backend",
          "files_to_modify": [
            "services/vast_service.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "python -c \"from services.vast_service import VastService; print('OK')\"",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Added template-aware methods to VastService: search_offers_for_template, create_instance_from_template, validate_gpu_for_template, get_template_deployment_config. Enables marketplace to deploy templates with GPU validation. Commit: 87e7ad5",
          "updated_at": "2025-12-31T21:55:51.233759+00:00"
        }
      ]
    },
    {
      "id": "phase-3-backend-api",
      "name": "Backend API Routes",
      "type": "implementation",
      "description": "Create Flask blueprint for template API endpoints (list, get by slug, deploy)",
      "depends_on": [
        "phase-2-backend-service"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create templates Flask blueprint with list and get endpoints",
          "service": "backend",
          "files_to_modify": [],
          "files_to_create": [
            "src/api/templates.py"
          ],
          "patterns_from": [
            "src/api/instances.py"
          ],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:8000/api/templates",
            "expected_status": 200
          },
          "status": "completed",
          "notes": "Created templates FastAPI router with list and get endpoints. GET /api/templates returns all 4 templates with filtering by min_vram, category, and verified_only. GET /api/templates/{slug} returns individual template details. GET /api/templates/{slug}/gpu-requirements returns GPU requirements. Fixed deploy_wizard.py imports. Verification passed: curl http://localhost:8000/api/templates returns 200 with 4 templates. Commit: b2601eb",
          "updated_at": "2025-12-31T22:10:50.863986+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Add template deployment endpoint to templates blueprint",
          "service": "backend",
          "files_to_modify": [
            "src/api/templates.py"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/api/instances.py"
          ],
          "verification": {
            "type": "api",
            "method": "POST",
            "url": "http://localhost:8000/api/templates/jupyter-lab/deploy",
            "body": {
              "gpu_id": 1
            },
            "expected_status": 201
          },
          "status": "completed",
          "notes": "Added POST /api/templates/{slug}/deploy endpoint with DeployTemplateRequest/DeployTemplateResponse schemas. Endpoint validates template exists, supports demo mode, validates GPU meets template VRAM requirements, creates instance via VastService.create_instance_from_template, returns 201 with deployment details. Also added GET /api/templates/{slug}/offers endpoint for listing compatible GPU offers. Verification passed: curl -X POST http://localhost:8000/api/templates/jupyter-lab/deploy returns 201. Commit: 70ab2b8",
          "updated_at": "2025-12-31T22:25:25.511486+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Register templates blueprint in main Flask app",
          "service": "backend",
          "files_to_modify": [
            "app.py"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q \"templates_bp\" app.py && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created Flask blueprint for templates at src/api/templates.py with endpoints: GET /api/templates (list), GET /api/templates/{slug} (get by slug), GET /api/templates/{slug}/gpu-requirements, POST /api/templates/{slug}/deploy, GET /api/templates/{slug}/offers. Registered templates_bp in app.py. Verification passed: grep -q \"templates_bp\" app.py returns OK. Commit: 8418a92",
          "updated_at": "2025-12-31T22:31:20.265173+00:00"
        }
      ]
    },
    {
      "id": "phase-4-frontend-state",
      "name": "Frontend Redux State",
      "type": "implementation",
      "description": "Create Redux slice for template state management with async thunks",
      "depends_on": [
        "phase-3-backend-api"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create templateSlice with async thunks for API calls",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/store/slices/templateSlice.js"
          ],
          "patterns_from": [
            "web/src/store/slices/instancesSlice.js"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q \"createAsyncThunk\" web/src/store/slices/templateSlice.js && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created templateSlice.js with Redux Toolkit createAsyncThunk for API calls. Implements fetchTemplates, fetchTemplateBySlug, fetchTemplateOffers, and deployTemplate async thunks. Includes state management for templates list, selectedTemplate, offers, filters (min_vram, category, verified_only), and deployment status. Exports actions and selectors following instancesSlice.js patterns. Verification passed. Commit: 7611123",
          "updated_at": "2025-12-31T22:33:54.875215+00:00"
        },
        {
          "id": "subtask-4-2",
          "description": "Register templateSlice in Redux store",
          "service": "frontend",
          "files_to_modify": [
            "web/src/store/index.js"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q \"templateReducer\" web/src/store/index.js && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Registered templateReducer in Redux store. Added import for templateSlice and added templates: templateReducer to the reducer configuration. Verification passed.",
          "updated_at": "2025-12-31T22:35:27.159612+00:00"
        }
      ]
    },
    {
      "id": "phase-5-frontend-components",
      "name": "Frontend Components",
      "type": "implementation",
      "description": "Create reusable template UI components (TemplateCard, TemplateFilters)",
      "depends_on": [
        "phase-4-frontend-state"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create marketplace components directory",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/components/marketplace/.gitkeep"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "test -d web/src/components/marketplace && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created marketplace components directory with .gitkeep file. Verification passed.",
          "updated_at": "2025-12-31T22:36:21.369244+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Create TemplateCard component with GPU requirements badge",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/components/marketplace/TemplateCard.jsx"
          ],
          "patterns_from": [
            "web/src/components/machines/MachineCard.jsx"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q \"export.*TemplateCard\" web/src/components/marketplace/TemplateCard.jsx && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "in_progress",
          "notes": "Creating TemplateCard component with GPU requirements badge following MachineCard patterns",
          "updated_at": "2025-12-31T22:37:11.401865+00:00"
        },
        {
          "id": "subtask-5-3",
          "description": "Create TemplateFilters component for GPU VRAM filtering",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/components/marketplace/TemplateFilters.jsx"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q \"export.*TemplateFilters\" web/src/components/marketplace/TemplateFilters.jsx && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-frontend-pages",
      "name": "Frontend Pages",
      "type": "implementation",
      "description": "Create marketplace UI pages (TemplatePage for list, TemplateDetailPage for individual template)",
      "depends_on": [
        "phase-5-frontend-components"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Create TemplatePage with grid layout and filters",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/pages/TemplatePage.jsx"
          ],
          "patterns_from": [
            "web/src/pages/Machines.jsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:8000/templates",
            "checks": [
              "Page renders",
              "No console errors",
              "Template cards visible"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Create TemplateDetailPage with deployment form",
          "service": "frontend",
          "files_to_modify": [],
          "files_to_create": [
            "web/src/pages/TemplateDetailPage.jsx"
          ],
          "patterns_from": [
            "web/src/pages/Machines.jsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:8000/templates/jupyter-lab",
            "checks": [
              "Page renders",
              "Template details shown",
              "Deploy button visible"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-3",
          "description": "Add template routes to React Router in App.jsx",
          "service": "frontend",
          "files_to_modify": [
            "web/src/App.jsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q \"TemplatePage\" web/src/App.jsx && echo 'OK' || echo 'FAIL'",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-integration",
      "name": "Integration & E2E Testing",
      "type": "integration",
      "description": "Verify full template marketplace flow end-to-end (browse \u2192 select \u2192 deploy)",
      "depends_on": [
        "phase-6-frontend-pages"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Manual E2E test: browse templates marketplace",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Start backend and frontend services",
              "Navigate to /templates",
              "Verify 4 template cards render",
              "Apply GPU VRAM filter",
              "Verify filtered results update",
              "Click template card",
              "Verify navigation to template detail page"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-2",
          "description": "Manual E2E test: template deployment flow",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Navigate to /templates/jupyter-lab",
              "Verify template details display (GPU requirements, ports, volumes)",
              "Click Deploy button",
              "Verify GPU selection dropdown appears",
              "Select compatible GPU",
              "Submit deployment",
              "Verify API call to POST /api/templates/jupyter-lab/deploy",
              "Verify success message with instance details"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-3",
          "description": "Verify no regressions in existing functionality",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Test existing instance management flows: 1) Dashboard loads without errors, 2) Machines page lists instances, 3) Instance creation still works via existing flow"
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 7,
    "total_subtasks": 19,
    "services_involved": [
      "backend",
      "frontend"
    ],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-1-backend-models"
          ],
          "reason": "Initial setup, no dependencies"
        },
        {
          "phases": [
            "phase-2-backend-service"
          ],
          "reason": "Service layer can be built after models exist"
        },
        {
          "phases": [
            "phase-4-frontend-state",
            "phase-5-frontend-components"
          ],
          "reason": "Redux state and components can be built in parallel once API exists"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential implementation recommended due to tight coupling between layers"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 007 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration",
      "e2e"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All 4 templates accessible via API",
      "Template marketplace UI renders without errors",
      "Template deployment flow completes successfully",
      "No regressions in existing instance management",
      "Frontend state management works correctly",
      "Backend API returns proper error messages for invalid requests"
    ],
    "verification_steps": [
      {
        "name": "Backend Unit Tests",
        "command": "pytest tests/ -k template",
        "expected_outcome": "All template-related tests pass",
        "type": "test",
        "required": false,
        "blocking": false
      },
      {
        "name": "Frontend Unit Tests",
        "command": "cd web && npm test -- --grep template",
        "expected_outcome": "Template component tests pass",
        "type": "test",
        "required": false,
        "blocking": false
      },
      {
        "name": "API Integration Test",
        "command": "curl http://localhost:8000/api/templates",
        "expected_outcome": "Returns 4 templates in JSON format",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "E2E Browser Test",
        "command": "npx playwright test tests/templates.spec.js",
        "expected_outcome": "Full marketplace flow works",
        "type": "test",
        "required": false,
        "blocking": false
      }
    ],
    "reasoning": "Medium risk due to new feature addition that integrates with existing Vast.ai provisioning. Requires integration testing to verify API contracts and E2E testing to validate full user flow."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [
        "pytest tests/ -k template"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "curl http://localhost:8000/api/templates"
      ],
      "services_to_test": [
        "backend"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "npx playwright test"
      ],
      "flows": [
        "browse-templates",
        "deploy-template"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:8000/templates",
          "checks": [
            "renders",
            "no-console-errors",
            "4-template-cards-visible"
          ]
        },
        {
          "url": "http://localhost:8000/templates/jupyter-lab",
          "checks": [
            "renders",
            "template-details-shown",
            "deploy-button-visible"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": null,
  "last_updated": "2025-12-31T22:37:11.401880+00:00"
}